# Securing MQTT
MQTT is a lightweight protocol that runs over TCP/IP to transport messages in a publish subscribe-paradigm. Since it was developed for IoT devices, it has no security by design at all. The scope of my thesis work at Brain Technologies is to provide a mechanism to secure MQTT. 

## Key distribution
The main problem, regardless any kind of scenario or level of security to provide, is key distribution. The idea is to provide asymmetric key pair to IoT device trough separation of knowledge: an algorithm to generate keys is divided into two parts, one stored into the IoT device and one into a smartcard (or in a server, and then obtained by using a smartphone through a secure channel). Once the IoT device has received the second part through NFC, it is able to generate the asymmetric key pair. In my project, the pair is generated starting from a master key obtained from a xor operation of a key stored in the IoT device itself and one key obtained from the server. 

### Folders organization
The repository is divided in the following folders:
* simple_example: a Python simulation (in localhost) of key distribution with two different possibilities:
    1. Socket is used to simulate NFC connection between the IoT device (IoT_dev.py) and a smartcard (smartcard.py), from wich the device receives a part of knowledge. At this point, it is able to generate the asymmetric key pair;
    2. Socket is used to simulate a smartphone (smartphone.py) connecting to a server (server.py) connection protected by a pre-shared key. The smartphone receives a part of knowledge, forwarded to the IoT device through NFC (simulated again using socket). Now the device is able to generate the asymmetric key pair.
* nginx_server: the actual implementation of the server, realized in cloud through a droplet in DigitalOcean and configured using nginx. Let's consider the case in which a company is in charge to realize key distribution for IoT device. There are two possibilities: 
    1. ssl_configuration: the company generates an SSL certificate from its CA root and distribute it to its clients. In this way, they are able to connect to company site and obtain the knowledge of selected IoT device in a secure way. There is also a client authentication with username and password. It is then necessary to forward the knowledge from the client to the IoT device through NFC.
    2. application: the company distributes pre-shared keys different for each client and associated to an IoT device to protect client-server connection. Only who has a valid key can obtain the knowledge of the correspondig IoT device. In particular, the client uses an application to send an HTTP POST request to the server to receive the knowledge. The path will contain an ID associated to the IoT device, while the body will be a timestamp encrypted with the corresponding psk. The server decrypts the body using the same psk given the ID and, after a check on the timestamp to protect against replay attack, sends back the knowledge encrypted with the same psk. 
* smartphoneapp: it contains the actual application code, used to send the POST request to the server. It is necessary to have at least one of the pre-shared keys to obtain the knowledge of the corresponding IoT device. Once obtained from the server, it is decrypted and written as NDEF message into a smartcard. 
